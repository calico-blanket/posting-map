# プロジェクト経過報告: ポスティング管理マップ

## プロジェクト概要
ポスティング（チラシ配布）活動を支援するための地図アプリ開発。
**技術スタック:** Next.js 16 (App Router), Firebase (Auth, Firestore), Leaflet (React-Leaflet), Tailwind CSS, Vercel.

## 開発ロードマップとマイルストーン

### 1. 初期セットアップと基本機能
- Next.js + TypeScript プロジェクトの立ち上げ。
- **Firebase Authentication** の導入（Googleログイン）。
- **Leaflet Map** の導入と、図形描画機能 (`leaflet-draw`) の実装。
- **課題:** Firestoreは「配列の配列（GeoJSONの座標データ）」を直接保存できない制約があった。
- **解決策:** データ保存時に座標データを適切な形式に変換（シリアライズ）する仕組みを作成して解決。

### 2. 地図とUI機能の実装
- 「現在地を表示する」機能の追加。
- アプリ起動時に、自動的に現在地中心に地図を表示するように改善。
- ポップアップ内に「エリア編集フォーム (`AreaEditForm`)」を作成。ステータス（予定・完了・中止）とメモを管理可能に。
- **課題:** ボタンを押したときに、裏にある地図までクリックされてしまう問題。
- **解決策:** `e.stopPropagation()` をイベントに適用して、クリック操作が地図に伝わらないように修正。

### 3. PWA（スマホアプリ化）対応
- `next-pwa` を導入し、スマホのホーム画面にインストール可能に設定。
- `manifest.json` を作成し、アプリアイコンやテーマカラーを設定。
- **課題:** Next.js 16の標準ビルドツール (Turbopack) が `next-pwa` と競合してエラーが発生。
- **解決策:** `package.json` でビルド設定を `next build --webpack` に変更し、従来のWebpackを使うことで解決。

### 4. デプロイとセキュリティ設定
- **Vercel** への本番公開（デプロイ）。
- 環境変数 (`.env.local`) の設定。
- **課題:** 本番環境で「データベースへのアクセス拒否」エラーが発生。
- **解決策:** Firestoreのセキュリティルールを更新し、Firebase管理画面でVercelのドメインを許可リストに追加。

### 5. デザインとブランディング
- AI画像生成を使用し、オリジナルのアプリアイコン（ミントグリーン＋黄色ピン）を作成・適用。
- アプリ全体のテーマカラーを「青」から、チームカラーの「ティール（青緑）」に統一。

### 6. その他
- デモ動画の自動撮影を試行したが、ブラウザ操作の安定性を優先し、コードを本番用の状態に復元・整理。
- Gitリポジトリを初期化し、ソースコード管理を確立。

## 現在の状況 (2025/12/27)
- **状態:** 機能実装完了、Vercelにて稼働中、スマホインストール可能。
- **URL:** [Vercel Deployment URL]
- **次のステップ案:**
    - エクセル/CSV形式でのデータ書き出し機能。
    - 特定のメンバーのみ利用可能にするユーザー制限（Allowlist）機能。
